{% load humanize %}
{% load sekizai_tags %}

{% addtoblock "css" %}
<style>
    .content-info span.trinn {
        display: inline-block;
        height: 30px;
        width: 30px;
        line-height: 30px;
        -moz-border-radius: 30px; /* or 50% */
        border-radius: 30px; /* or 50% */
        background-color: #333;
        color: white;
        text-align: center;
        font-size: 1em;
    }
</style>
{% endaddtoblock %}

<!-- event-info -->
<h3 class="pull-left">Informasjon </h3>


{% if event.facebook_url %}
<h3 class="pull-right">
    <a target="_blank" href="{{ event.facebook_url }}" class="btn btn-default btn-sm">
        <span class="fa fa-facebook-square"></span>
        Vis på Facebook
    </a>
</h3>
{% endif %}

<table class="table table-bordered table-striped content-info" style="table-layout: fixed;">

    <!-- Fra -->
    <tr>
        <td style="width:120px;">Starter</td>
        <td>
            <time datetime="{{ event.event_start|date:"c" }}">
                <b>{{ event.event_start|naturalday }} kl. {{ event.event_start|date:"H:i" }}</b>
            </time>
        </td>
    </tr>

    <!-- Til -->
    {% if event.event_end %}
    <tr>
        <td>Slutter</td>
        <td>
            <time datetime="{{ event.event_end|date:"c" }}">
                {{ event.event_end|naturalday }} kl. {{ event.event_end|date:"H:i" }}
            </time>
        </td>
    </tr>
    {% endif %}

    <!-- Sted -->
    <tr><td>Sted</td><td>{{ event.location }}</td></tr>


    {% block more_info %}
    {% endblock %} 

{% if event.registration_required %}
    <!-- Registrering åpner -->
    {% if event.registration_start %}
    <tr>
        <td>Registrering åpner</td>
        <td>
            <time datetime="{{ event.registration_start|date:"c" }}">
                {{ event.registration_start|naturalday }} kl. {{ event.registration_start|date:"H:i" }}
            </time>
        </td>
    </tr>
    {% endif %}

    <!-- Påmeldingsfrist -->
    {% if event.registration_deadline %}
    {% block open_for %}
    <tr>
        <td>Trinn</td>
            <td>
                {% for group in classnumber %}
                        <span class = "trinn">
                            {{ group }}
                        </span>
                {% endfor %}
            </td>
    </tr>
    {% endblock %}
    <tr>
        <td>Påmeldingsfrist</td>
        <td>
            <time datetime="{{ event.registration_deadline|date:"c" }}">
                {{ event.registration_deadline|naturalday }} kl. {{ event.registration_deadline|date:"H:i" }}
            </time>
        </td>
    </tr>
    {% endif %}

    <!-- Avmeldingsfrist -->
    {% if event.deregistration_deadline %}
    <tr>
        <td>Avmeldingsfrist</td>
        <td>
            <time datetime="{{ event.deregistration_deadline|date:"c" }}">
                {{ event.deregistration_deadline|naturalday }} kl. {{ event.deregistration_deadline|date:"H:i" }}
            </time>
        </td>
    </tr>
    {% endif %}

    <tr>
        <td style="text-align: center;" colspan="2">
            {% if is_attending %}
                <span class="glyphicon glyphicon-ok"></span>
                <strong>Du er påmeldt</strong>
            {% elif is_waiting %}
                Du står på venteliste
            {% else %}
                Påmelding kreves
            {% endif %}
        </td>
    </tr>

    <!-- På/Avmeldingsknapp -->
    <form name="registration" action="{{ event.get_registration_url }}" method="post">
    {% csrf_token %}
    <tr><td colspan="2" style="text-align: center;">
        {% if not is_registered %} {# Show registration button #}
            <input type="hidden" name="registration_type" value="registration">
            {% if event.registration_open %}
                <input type="submit"
                       class="btn btn-primary"
                       value="Meld deg på {% if event.has_queue and event.is_full %}ventelisten{% endif %}">
            {% else %}
                Påmeldingen er stengt.
            {% endif %}
        {% else %} {# Show deregistration button #}
            <input type="hidden" name="registration_type" value="deregistration">
            {% if event.deregistration_closed %}
                Avmeldingsfristen er ute.
            {% else %}
                <a href="#"
                   id="meld-av"
                   class="btn btn-primary">Meld deg av
                    {% if is_waiting %}ventelisten{% endif %}
                </a>
                <br>
                <input type="submit"
                       id="meld-av-confirm"
                       class="btn btn-primary btn-warning"
                       value="Er du sikker?"
                        >
                <script>
                    $("#meld-av-confirm").hide();
                    $("#meld-av").on("click", function(event) {
                        event.preventDefault();
                        $("#meld-av-confirm").slideDown();
                    });
                </script>
            {% endif %}
        {% endif %}
    </td></tr>
    </form>
{% endif %}
</table>





{% if event.registration_required %}
<h3>{{ event.users_attending }} påmeldt av {{ event.places }} plasser</h3>
<div class="progress">
    <div class="progress-bar
    {% if 80 <= event.percent_full and event.percent_full < 100 %}
        progress-bar-warning
    {% elif event.percent_full == 100 %}
        progress-bar-danger
    {%endif %}"
    style="width: {{ event.percent_full }}%;">
    </div>
</div>
{% endif %}

<div class="center">
    {% if event.bpcid %}
    <a class="btn btn-default btn-xs" href="{% url "bedpres_ical_event" event.pk %}">
        <span class="glyphicon glyphicon-calendar"></span>
        iCal
    </a>
    {% else %}
    <a class="btn btn-default btn-xs" href="{% url "ical_event" event.pk %}">
        <span class="glyphicon glyphicon-calendar"></span>
        iCal
    </a>
    {% endif %}
    <a class="btn btn-default btn-xs" href="https://calendar.google.com/calendar/r/eventedit?text={{ event.headline }}&dates={{event.event_start|date:'Ymd\THis' }}/{{event.event_end|date:'Ymd\THis' }}&details={{ request.build_absolute_uri }}&location={{ event.location }}&sf=true&output=xml&pli=1" target ="_blank">
    <span class="fa fa-calendar"></span>
    Google kalender
</a>
</div>


