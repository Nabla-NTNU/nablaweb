{% load humanize %}
{% load event_extras %}

<!-- event-info -->
<h3 class="pull-left">Informasjon </h3>

{% if event.facebook_url %}
<h3 class="pull-right">
    <a target="_blank" href="{{ event.facebook_url }}" class="btn btn-sm">
        <span class="icon-custom icon-facebook"></span> Vis på Facebook
    </a>
</h3>
{% endif %}

<table class="table table-bordered table-striped content-info" style="table-layout: fixed;">

    <!-- Fra -->
    <tr>
        <td style="width:120px;">Starter</td>
        <td>
            <time datetime="{{ event.event_start|date:"c" }}">
                <b>{{ event.event_start|naturalday }} kl. {{ event.event_start|date:"H:i" }}</b>
            </time>
        </td>
    </tr>

    <!-- Til -->
    {% if event.event_end %}
    <tr>
        <td>Slutter</td>
        <td>
            <time datetime="{{ event.event_end|date:"c" }}">
                {{ event.event_end|naturalday }} kl. {{ event.event_end|date:"H:i" }}
            </time>
        </td>
    </tr>
    {% endif %}

    <!-- Sted -->
    <tr><td>Sted</td><td>{{ event.location }}</td></tr>


{% if event.registration_required %}
    <!-- Registrering åpner -->
    {% if event.registration_start %}
    <tr>
        <td>Registrering åpner</td>
        <td>
            <time datetime="{{ event.registration_start|date:"c" }}">
                {{ event.registration_start|naturalday }} kl. {{ event.registration_start|date:"H:i" }}
            </time>
        </td>
    </tr>
    {% endif %}

    <!-- Påmeldingsfrist -->
    {% if event.registration_deadline %}
    <tr>
        <td>Påmeldingsfrist</td>
        <td>
            <time datetime="{{ event.registration_deadline|date:"c" }}">
                {{ event.registration_deadline|naturalday }} kl. {{ event.registration_deadline|date:"H:i" }}
            </time>
        </td>
    </tr>
    {% endif %}

    <!-- Avmeldingsfrist -->
    {% if event.deregistration_deadline %}
    <tr>
        <td>Avmeldingsfrist</td>
        <td>
            <time datetime="{{ event.deregistration_deadline|date:"c" }}">
                {{ event.deregistration_deadline|naturalday }} kl. {{ event.deregistration_deadline|date:"H:i" }}
            </time>
        </td>
    </tr>
    {% endif %}

    <tr>
        <td style="text-align: center;" colspan="2">
            {% if event.registration_required %}
                {% if is_attending %}
                    <i class="icon-ok"></i> <b>Du er påmeldt</b>
                {% else %}
                    {% if is_registered %}
                        Du står på venteliste
                    {% else %}
                        Påmelding kreves
                    {% endif %}
                {% endif %}
            {% else %}
                Påmelding unødvendig
            {% endif %}
        </td>
    </tr>

    <!-- På/Avmeldingsknapp -->
    <form name="registration" action="{{event.id}}/registration" method="post">
    {% csrf_token %}
    <input type="hidden" name="eventid" value="{{event.id}}">
    <tr><td colspan="2" style="text-align: center;">
        {% if is_registered %}
            {% if event.deregistration_closed %}
                Avmeldingsfristen er ute.
            {% else %}
            <input type="hidden" name="registration_type" value="deregistration">
            <a href="#" 
                id="meld-av"
                class="btn btn-primary">Meld deg av
                {% if is_registered and not is_attending %}ventelisten{% endif %}
            </a>
            <br>
            <input type="submit"
                id="meld-av-confirm"
                class="btn btn-primary btn-warning"
                value="Er du sikker?"
                >
            <script>
    $("#meld-av-confirm").hide();
    $("#meld-av").on("click", function(event) {
        event.preventDefault();
        $("#meld-av-confirm").slideDown();
    });
            </script>
            {% endif %}
        {% else %}
            {% if event.registration_open %}
            <input type="hidden" name="registration_type" value="registration">
            <input type="submit"
                class="btn btn-primary"
                value="Meld deg på {% if event.has_queue and event.is_full %}ventelisten{% endif %}">
            {% else %}
            Påmeldingen er stengt.
            {% endif %}
        {% endif %}
    </td></tr>
    </form>
{% endif %}
</table>





{% if event.registration_required %}
<h3>{{ event.users_attending }} påmeldt av {{ event.places }} plasser</h3>
<div class="progress
    {% if 80 <= event.percent_full and event.percent_full < 100 %}progress-warning{% endif %}
    {% if event.percent_full == 100 %}progress-danger{%endif %}">
    <div class="bar" style="width: {{ event.percent_full }}%;"></div>
</div>
{% endif %}

<div class="center">
<a class="btn btn-default btn-xs" href="{{ event|google_calendarize }}">
    <span class="glyphicon glyphicon-calendar"></span>
    Google Calendar
</a>

<a class="btn btn-default btn-xs" href="{% url "ical_event" event.pk %}">
    <span class="glyphicon glyphicon-calendar"></span>
    iCalendar
</a>
</div>
